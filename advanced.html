<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced &mdash; SWAP-IT Demonstration Scenario 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=8d563738"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How-To-Guides" href="how_to.html" />
    <link rel="prev" title="Intermediate" href="intermediate.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SWAP-IT Demonstration Scenario
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Demonstration Scenario Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="swpa_it_sw.html">SWAP-IT Software Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="getting_started.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="requ.html">Requirements and Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="tutorial.html">Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="beginner.html">Beginner</a></li>
<li class="toctree-l3"><a class="reference internal" href="intermediate.html">Intermediate</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Advanced</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#advanced-writing-custom-pfdl-files">Advanced: Writing custom PFDL files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-building-resource-specific-information-models">Advanced: Building Resource-specific Information Models</a><ul>
<li class="toctree-l5"><a class="reference internal" href="pfdl_namespace.html">PFDL Parameter Namespace</a></li>
<li class="toctree-l5"><a class="reference internal" href="warehouse_namespace.html">Warehouse Namespace</a></li>
<li class="toctree-l5"><a class="reference internal" href="coating_namespace.html">Coating Namespace</a></li>
<li class="toctree-l5"><a class="reference internal" href="gluing_namespace.html">Gluing Namespace</a></li>
<li class="toctree-l5"><a class="reference internal" href="milling_namespace.html">Milling Namespace</a></li>
<li class="toctree-l5"><a class="reference internal" href="mounting_namespace.html">Mounting Namespace</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-build-custom-opc-ua-servers">Advanced: Build custom OPC UA Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-writing-a-json-configuration-file">Advanced: Writing a JSON-configuration File</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#warehouse-configuration">Warehouse Configuration</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#warehouse-1">Warehouse 1</a></li>
<li class="toctree-l6"><a class="reference internal" href="#warehouse-2">Warehouse 2</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#coating-configuration">Coating Configuration</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#coating-1">Coating 1</a></li>
<li class="toctree-l6"><a class="reference internal" href="#coating-2">Coating 2</a></li>
<li class="toctree-l6"><a class="reference internal" href="#coating-3">Coating 3</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#gluing-configuration">Gluing Configuration</a></li>
<li class="toctree-l5"><a class="reference internal" href="#mounting-configuration">Mounting Configuration</a></li>
<li class="toctree-l5"><a class="reference internal" href="#milling-configuration">Milling Configuration</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-cmake-configuration">Advanced: CMake Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-build-server">Advanced: Build Server</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#advanced-build-the-server-executable">Advanced: Build the Server Executable</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-execute-the-pfdl-with-a-process-agent">Advanced: Execute the PFDL with a Process Agent</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#start-the-application-with-docker-images">Start the Application with Docker Images</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#step-1-start-the-device-registry">Step 1: Start the Device Registry</a></li>
<li class="toctree-l6"><a class="reference internal" href="#step-2-start-the-shop-floor-server">Step 2: Start the Shop Floor Server</a></li>
<li class="toctree-l6"><a class="reference internal" href="#step-3-start-the-process-agent">Step 3: Start the Process Agent</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="how_to.html">How-To-Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="related_projects.html">Related-Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SWAP-IT Demonstration Scenario</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="getting_started.html">Getting Started</a></li>
          <li class="breadcrumb-item"><a href="tutorial.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Advanced</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/advanced.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="advanced">
<h1>Advanced<a class="headerlink" href="#advanced" title="Link to this heading"></a></h1>
<p>The advanced tutorial recreates the SWAP-IT Demonstration Scenario (See :ref: <cite>Demonstration Scenario Process</cite>. Consequently, the PFDL description is extended with the manufacture stand segment subprocess that includes a GetPartsFromWarehouse and a Milling service. To combine both subprocesses,
manufacture light segments and manufacture stand segment, the PDFL description completes the process with a Mounting service that mounts the light segments onto the stand segment. In addition, the assignment strategy differs to the intermediate and the beginner tutorial, so that this tutorial does not
feature a static resource assignment through a PFDL definition, instead it utilizes the dynamic resource assignment with a device registry and an assignment agent (see <a class="reference internal" href="swpa_it_sw.html#resource-assignment"><span class="std std-ref">Resource Assignment</span></a>).</p>
<section id="advanced-writing-custom-pfdl-files">
<h2>Advanced: Writing custom PFDL files<a class="headerlink" href="#advanced-writing-custom-pfdl-files" title="Link to this heading"></a></h2>
<p>The required structures remain the same compared to the beginner’s and the intermediate’s tutorial. However, since the assignment in accomplished with an assignment agent, the ResourceAssignment structure is no longer required.
Besides, the productionTask is extended with a Parallel condition with features on the one hand the manufacture_light_segments task, that is also defined in the intermediate’s tutorial and on the other hand a new task, the manufacture_stand_segment task. Within this task,
a workpiece is taken from a warehouse and then processed by a milling machine to create a required shape for the stand. To complete the productionTask, a final Mounting task is added outside the Parallel condition, that mounts the light segments, produces in subprocess one, onto
the stand segment, produced in subprocess two.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Struct</span> <span class="n">SWAP_Order</span>
    <span class="n">order_id</span><span class="p">:</span><span class="n">number</span>
    <span class="n">stand</span><span class="p">:</span><span class="n">Stand_Segment</span>
    <span class="n">segments</span><span class="p">:</span> <span class="n">Light_Segment</span><span class="p">[]</span>
    <span class="n">number_light_segments</span><span class="p">:</span> <span class="n">number</span>
<span class="n">End</span>

<span class="n">Struct</span> <span class="n">Stand_Segment</span>
    <span class="n">stand_shape</span><span class="p">:</span><span class="n">string</span>
    <span class="n">stand_height</span><span class="p">:</span><span class="n">number</span>
    <span class="n">stand_id</span><span class="p">:</span><span class="n">string</span>
<span class="n">End</span>

<span class="n">Struct</span> <span class="n">Light_Segment</span>
    <span class="n">color</span><span class="p">:</span> <span class="n">string</span>
    <span class="n">diameter</span><span class="p">:</span> <span class="n">number</span>
    <span class="n">segment_id</span><span class="p">:</span><span class="n">string</span>
<span class="n">End</span>

<span class="n">Task</span> <span class="n">productionTask</span>
    <span class="n">Parallel</span>
        <span class="n">manufacture_light_segments</span>
            <span class="n">In</span>
                <span class="n">SWAP_Order</span>
                <span class="p">{</span>
                    <span class="s2">&quot;order_id&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span>
                    <span class="s2">&quot;stand&quot;</span><span class="p">:{</span>
                        <span class="s2">&quot;stand_shape&quot;</span><span class="p">:</span><span class="s2">&quot;plate&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;stand_height&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                        <span class="s2">&quot;stand_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;segments&quot;</span><span class="p">:</span>
                    <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                        <span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                        <span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                    <span class="p">}</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;number_light_segments&quot;</span><span class="p">:</span> <span class="mi">5</span>
                <span class="p">}</span>
        <span class="n">manufacture_stand_segment</span>
            <span class="n">In</span>
                <span class="n">SWAP_Order</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;order_id&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span>
                        <span class="s2">&quot;stand&quot;</span><span class="p">:{</span>
                            <span class="s2">&quot;stand_shape&quot;</span><span class="p">:</span><span class="s2">&quot;plate&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;stand_height&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                            <span class="s2">&quot;stand_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;segments&quot;</span><span class="p">:</span>
                        <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Default&quot;</span>
                        <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;number_light_segments&quot;</span><span class="p">:</span> <span class="mi">5</span>
                    <span class="p">}</span>
            <span class="n">Out</span>
                <span class="n">order</span><span class="p">:</span><span class="n">SWAP_Order</span>
    <span class="n">Mounting</span>
        <span class="n">In</span>
            <span class="n">order</span>
        <span class="n">Out</span>
            <span class="n">order</span><span class="p">:</span><span class="n">SWAP_Order</span>
<span class="n">End</span>


<span class="n">Task</span> <span class="n">manufacture_stand_segment</span>
    <span class="n">In</span>
        <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
    <span class="n">GetPartsFromWarehouse</span>
        <span class="n">In</span>
            <span class="n">order</span>
        <span class="n">Out</span>
            <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
    <span class="n">Milling</span>
        <span class="n">In</span>
            <span class="n">order</span>
        <span class="n">Out</span>
            <span class="n">order</span><span class="p">:</span><span class="n">SWAP_Order</span>
    <span class="n">Out</span>
        <span class="n">order</span>
<span class="n">End</span>

<span class="n">Task</span> <span class="n">manufacture_light_segments</span>
    <span class="n">In</span>
        <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
    <span class="n">Parallel</span> <span class="n">Loop</span> <span class="n">i</span> <span class="n">To</span> <span class="n">order</span><span class="o">.</span><span class="n">number_light_segments</span>
        <span class="n">manufacture_light_segment</span>
            <span class="n">In</span>
                <span class="n">order</span>
            <span class="n">Out</span>
                <span class="n">order</span><span class="p">:</span><span class="n">SWAP_Order</span>
    <span class="n">Loop</span> <span class="n">i</span> <span class="n">To</span> <span class="n">order</span><span class="o">.</span><span class="n">number_light_segments</span>
        <span class="n">Gluing</span>
            <span class="n">In</span>
                <span class="n">order</span>
            <span class="n">Out</span>
                <span class="n">order</span><span class="p">:</span><span class="n">SWAP_Order</span>
<span class="n">End</span>

<span class="n">Task</span> <span class="n">manufacture_light_segment</span>
    <span class="n">In</span>
        <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
    <span class="n">GetPartsFromWarehouse</span>
        <span class="n">In</span>
            <span class="n">order</span>
        <span class="n">Out</span>
            <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
    <span class="n">Coating</span>
        <span class="n">In</span>
            <span class="n">order</span>
        <span class="n">Out</span>
            <span class="n">order</span><span class="p">:</span> <span class="n">SWAP_Order</span>
    <span class="n">Out</span>
        <span class="n">order</span>
<span class="n">End</span>
</pre></div>
</div>
<p>The resulting visual representation of the process is shown below:</p>
<figure class="align-default">
<img alt="alternate text" src="_images/petri_net.PNG" />
</figure>
</section>
<section id="advanced-building-resource-specific-information-models">
<h2>Advanced: Building Resource-specific Information Models<a class="headerlink" href="#advanced-building-resource-specific-information-models" title="Link to this heading"></a></h2>
<p>The pre-build <em>Model.Nodeset2.xml</em> files for each namespace in this tutorial can be found within the directory <a class="reference external" href="https://github.com/swap-it/demo-scenario/tree/main/Tutorials/advanced/model">InformationModels</a>.
However, if it is  planned to use the pre-build files, this section can be skipped and the tutorial continues with section <a class="reference internal" href="#advanced-build-custom-opc-ua-servers">Advanced Build custom OPC UA Servers</a>, however the following sections give a short introduction on how to
define <em>.ModelDesign.xml</em> files, which can then be processed with the <a class="reference external" href="https://github.com/OPCFoundation/UA-ModelCompiler">UA-ModelCompiler</a> to generate <em>Model.Nodeset2.xml</em> files.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="pfdl_namespace.html">PFDL Parameter Namespace</a></li>
<li class="toctree-l1"><a class="reference internal" href="warehouse_namespace.html">Warehouse Namespace</a></li>
<li class="toctree-l1"><a class="reference internal" href="coating_namespace.html">Coating Namespace</a></li>
<li class="toctree-l1"><a class="reference internal" href="gluing_namespace.html">Gluing Namespace</a></li>
<li class="toctree-l1"><a class="reference internal" href="milling_namespace.html">Milling Namespace</a></li>
<li class="toctree-l1"><a class="reference internal" href="mounting_namespace.html">Mounting Namespace</a></li>
</ul>
</div>
</section>
<section id="advanced-build-custom-opc-ua-servers">
<span id="id1"></span><h2>Advanced: Build custom OPC UA Servers<a class="headerlink" href="#advanced-build-custom-opc-ua-servers" title="Link to this heading"></a></h2>
<p>Similar to the intermediate tutorial, all servers will be started from one executable based on thread. To start several resource server from the same script,
the following example uses a thread based server start. This is fine for a simulation purpose, however, when connecting the servers to real physical resources, it
is recommended to implement each server in an individual application. The following gives a short introduction to such a thread based shop floor configuration.</p>
<p>In addition, the shop floor is extended to prevent bottle necks, so that instead of a single coating and a single warehouse module, the number of these modules is increased to three and two respectively.</p>
</section>
<section id="advanced-writing-a-json-configuration-file">
<span id="id2"></span><h2>Advanced: Writing a JSON-configuration File<a class="headerlink" href="#advanced-writing-a-json-configuration-file" title="Link to this heading"></a></h2>
<p>JSON files are required for each of the server, so that an overall number of 8 JSON configurations are defined. Since the dynamic resource assignment is used, minimal configuration is extended with the key device_registry_url</p>
<section id="warehouse-configuration">
<h3>Warehouse Configuration<a class="headerlink" href="#warehouse-configuration" title="Link to this heading"></a></h3>
<section id="warehouse-1">
<h4>Warehouse 1<a class="headerlink" href="#warehouse-1" title="Link to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warehouse_dr1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4081&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WarehouseModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WarehouseModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GetPartsFromWarehouse&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="warehouse-2">
<h4>Warehouse 2<a class="headerlink" href="#warehouse-2" title="Link to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warehouse_dr2&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4082&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WarehouseModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WarehouseModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GetPartsFromWarehouse&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="coating-configuration">
<h3>Coating Configuration<a class="headerlink" href="#coating-configuration" title="Link to this heading"></a></h3>
<section id="coating-1">
<h4>Coating 1<a class="headerlink" href="#coating-1" title="Link to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coating_dr1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4091&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CoatingModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CoatingModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Coating&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="coating-2">
<h4>Coating 2<a class="headerlink" href="#coating-2" title="Link to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coating_dr2&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4092&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CoatingModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CoatingModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Coating&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="coating-3">
<h4>Coating 3<a class="headerlink" href="#coating-3" title="Link to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coating_dr3&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4093&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CoatingModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CoatingModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Coating&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="gluing-configuration">
<h3>Gluing Configuration<a class="headerlink" href="#gluing-configuration" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gluing_dr1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4061&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GluingModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GluingModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Gluing&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mounting-configuration">
<h3>Mounting Configuration<a class="headerlink" href="#mounting-configuration" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mounting_dr1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4051&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MountingModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MountingModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Mounting&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="milling-configuration">
<h3>Milling Configuration<a class="headerlink" href="#milling-configuration" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;milling_dr1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4071&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MillingModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MillingModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Milling&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-cmake-configuration">
<h2>Advanced: CMake Configuration<a class="headerlink" href="#advanced-cmake-configuration" title="Link to this heading"></a></h2>
<p>Since all server application use the same installation of the open62541 OPC UA SDK, it is possible to extend the C-Make configuration,
so that the nodeset-compiler creates c-code from all information models. Besides it is necessary to link the library that is required for the threads.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">cmake_minimum_required</span><span class="p">(</span><span class="n">VERSION</span><span class="w"> </span><span class="mf">3.0.0</span><span class="p">)</span>
<span class="n">project</span><span class="p">(</span><span class="n">swap_server</span><span class="p">)</span>
<span class="n">find_package</span><span class="p">(</span><span class="n">open62541</span><span class="w"> </span><span class="mf">1.3</span><span class="w"> </span><span class="n">REQUIRED</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="n">NOT</span><span class="w"> </span><span class="n">CMAKE_PROJECT_NAME</span><span class="w"> </span><span class="n">STREQUAL</span><span class="w"> </span><span class="n">PROJECT_NAME</span><span class="p">)</span>
<span class="w">    </span><span class="cp"># needed or cmake doesn&#39;t recognize dependencies of generated files</span>
<span class="w">    </span><span class="n">set</span><span class="p">(</span><span class="n">PROJECT_BINARY_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">CMAKE_BINARY_DIR</span><span class="p">})</span>
<span class="n">endif</span><span class="p">()</span>

<span class="n">file</span><span class="p">(</span><span class="n">MAKE_DIRECTORY</span><span class="w"> </span><span class="s">&quot;${GENERATE_OUTPUT_DIR}&quot;</span><span class="p">)</span>
<span class="n">set</span><span class="p">(</span><span class="n">GENERATE_OUTPUT_DIR</span><span class="w"> </span><span class="s">&quot;${CMAKE_BINARY_DIR}/src_generated/&quot;</span><span class="p">)</span>
<span class="n">include_directories</span><span class="p">(</span><span class="s">&quot;${GENERATE_OUTPUT_DIR}&quot;</span><span class="p">)</span>
<span class="n">set</span><span class="p">(</span><span class="n">INFORMATION_MODEL_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">PROJECT_SOURCE_DIR</span><span class="p">}</span><span class="o">/</span><span class="n">Information_Models</span><span class="p">)</span>


<span class="n">ua_generate_nodeset_and_datatypes</span><span class="p">(</span>
<span class="w">        </span><span class="n">NAME</span><span class="w"> </span><span class="s">&quot;common&quot;</span>
<span class="w">        </span><span class="n">FILE_BSD</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Common.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">FILE_CSV</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/CommonModelDesign.csv&quot;</span>
<span class="w">        </span><span class="n">FILE_NS</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Common.Model.NodeSet2.xml&quot;</span>
<span class="w">        </span><span class="n">OUTPUT_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">GENERATE_OUTPUT_DIR</span><span class="p">}</span>
<span class="w">        </span><span class="n">INTERNAL</span>
<span class="p">)</span>

<span class="n">ua_generate_nodeset_and_datatypes</span><span class="p">(</span>
<span class="w">        </span><span class="n">NAME</span><span class="w"> </span><span class="s">&quot;pfdl_parameter&quot;</span>
<span class="w">        </span><span class="n">FILE_BSD</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">FILE_CSV</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/PatientZeroDataTypesModelDesign.csv&quot;</span>
<span class="w">        </span><span class="n">FILE_NS</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Model.NodeSet2.xml&quot;</span>
<span class="w">        </span><span class="n">OUTPUT_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">GENERATE_OUTPUT_DIR</span><span class="p">}</span>
<span class="w">        </span><span class="n">INTERNAL</span>
<span class="p">)</span>

<span class="n">ua_generate_nodeset_and_datatypes</span><span class="p">(</span>
<span class="w">        </span><span class="n">NAME</span><span class="w"> </span><span class="s">&quot;warehouse&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;common&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;pfdl_parameter&quot;</span>
<span class="w">        </span><span class="n">FILE_BSD</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Warehouse.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">FILE_CSV</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/PatientZeroWarehouseModelDesign.csv&quot;</span>
<span class="w">        </span><span class="n">FILE_NS</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Warehouse.Model.NodeSet2.xml&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_COMMON#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Common.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_PFDL_PARAMETER#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">OUTPUT_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">GENERATE_OUTPUT_DIR</span><span class="p">}</span>
<span class="w">        </span><span class="n">INTERNAL</span>
<span class="p">)</span>

<span class="n">ua_generate_nodeset_and_datatypes</span><span class="p">(</span>
<span class="w">        </span><span class="n">NAME</span><span class="w"> </span><span class="s">&quot;coating&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;common&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;pfdl_parameter&quot;</span>
<span class="w">        </span><span class="n">FILE_BSD</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Coating.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">FILE_CSV</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/CoatingModelDesign.csv&quot;</span>
<span class="w">        </span><span class="n">FILE_NS</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Coating.Model.NodeSet2.xml&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_COMMON#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Common.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_PFDL_PARAMETER#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">OUTPUT_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">GENERATE_OUTPUT_DIR</span><span class="p">}</span>
<span class="w">        </span><span class="n">INTERNAL</span>
<span class="p">)</span>

<span class="n">ua_generate_nodeset_and_datatypes</span><span class="p">(</span>
<span class="w">        </span><span class="n">NAME</span><span class="w"> </span><span class="s">&quot;milling&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;common&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;pfdl_parameter&quot;</span>
<span class="w">        </span><span class="n">FILE_BSD</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Milling.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">FILE_CSV</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/MillingModelDesign.csv&quot;</span>
<span class="w">        </span><span class="n">FILE_NS</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Milling.Model.NodeSet2.xml&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_COMMON#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Common.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_PFDL_PARAMETER#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">OUTPUT_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">GENERATE_OUTPUT_DIR</span><span class="p">}</span>
<span class="w">        </span><span class="n">INTERNAL</span>
<span class="p">)</span>

<span class="n">ua_generate_nodeset_and_datatypes</span><span class="p">(</span>
<span class="w">        </span><span class="n">NAME</span><span class="w"> </span><span class="s">&quot;gluing&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;common&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;pfdl_parameter&quot;</span>
<span class="w">        </span><span class="n">FILE_BSD</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Gluing.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">FILE_CSV</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/GluingModelDesign.csv&quot;</span>
<span class="w">        </span><span class="n">FILE_NS</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Gluing.Model.NodeSet2.xml&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_COMMON#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Common.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_PFDL_PARAMETER#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">OUTPUT_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">GENERATE_OUTPUT_DIR</span><span class="p">}</span>
<span class="w">        </span><span class="n">INTERNAL</span>
<span class="p">)</span>

<span class="n">ua_generate_nodeset_and_datatypes</span><span class="p">(</span>
<span class="w">        </span><span class="n">NAME</span><span class="w"> </span><span class="s">&quot;mounting&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;common&quot;</span>
<span class="w">        </span><span class="n">DEPENDS</span><span class="w"> </span><span class="s">&quot;pfdl_parameter&quot;</span>
<span class="w">        </span><span class="n">FILE_BSD</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Mounting.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">FILE_CSV</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/MountingModelDesign.csv&quot;</span>
<span class="w">        </span><span class="n">FILE_NS</span><span class="w"> </span><span class="s">&quot;${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Mounting.Model.NodeSet2.xml&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_COMMON#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Common.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">IMPORT_BSD</span><span class="w"> </span><span class="s">&quot;TYPES_PFDL_PARAMETER#${INFORMATION_MODEL_DIR}/SWAP.Fraunhofer.Patient.Zero.Model.Types.bsd&quot;</span>
<span class="w">        </span><span class="n">OUTPUT_DIR</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">GENERATE_OUTPUT_DIR</span><span class="p">}</span>
<span class="w">        </span><span class="n">INTERNAL</span>
<span class="p">)</span>

<span class="n">add_executable</span><span class="p">(</span><span class="n">swap_server</span>
<span class="w">        </span><span class="n">main</span><span class="p">.</span><span class="n">c</span>
<span class="w">        </span><span class="n">custom_behavior</span><span class="o">/</span><span class="n">service_callbacks</span><span class="p">.</span><span class="n">c</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_NODESET_PFDL_PARAMETER_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_TYPES_PFDL_PARAMETER_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_NODESET_COMMON_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_TYPES_COMMON_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_NODESET_WAREHOUSE_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_TYPES_WAREHOUSE_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_NODESET_COATING_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_TYPES_COATING_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_NODESET_MILLING_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_TYPES_MILLING_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_NODESET_GLUING_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_TYPES_GLUING_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_NODESET_MOUNTING_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">UA_TYPES_MOUNTING_SOURCES</span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>

<span class="n">add_dependencies</span><span class="p">(</span><span class="n">swap_server</span><span class="w"> </span><span class="n">open62541</span><span class="o">-</span><span class="n">generator</span><span class="o">-</span><span class="n">ns</span><span class="o">-</span><span class="n">common</span>
<span class="w">                             </span><span class="n">open62541</span><span class="o">-</span><span class="n">generator</span><span class="o">-</span><span class="n">ns</span><span class="o">-</span><span class="n">pfdl_parameter</span>
<span class="w">                             </span><span class="n">open62541</span><span class="o">-</span><span class="n">generator</span><span class="o">-</span><span class="n">ns</span><span class="o">-</span><span class="n">warehouse</span>
<span class="w">                             </span><span class="n">open62541</span><span class="o">-</span><span class="n">generator</span><span class="o">-</span><span class="n">ns</span><span class="o">-</span><span class="n">coating</span>
<span class="w">                             </span><span class="n">open62541</span><span class="o">-</span><span class="n">generator</span><span class="o">-</span><span class="n">ns</span><span class="o">-</span><span class="n">milling</span>
<span class="w">                             </span><span class="n">open62541</span><span class="o">-</span><span class="n">generator</span><span class="o">-</span><span class="n">ns</span><span class="o">-</span><span class="n">gluing</span>
<span class="w">                             </span><span class="n">open62541</span><span class="o">-</span><span class="n">generator</span><span class="o">-</span><span class="n">ns</span><span class="o">-</span><span class="n">mounting</span>
<span class="w">        </span><span class="p">)</span>
<span class="n">target_link_libraries</span><span class="p">(</span><span class="n">swap_server</span><span class="w"> </span><span class="n">swap_server_template</span><span class="p">)</span>
<span class="n">target_link_libraries</span><span class="p">(</span><span class="n">swap_server</span><span class="w"> </span><span class="n">open62541</span><span class="o">::</span><span class="n">open62541</span><span class="p">)</span>
<span class="n">target_link_libraries</span><span class="p">(</span><span class="n">swap_server</span><span class="w"> </span><span class="n">pthread</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-build-server">
<h2>Advanced: Build Server<a class="headerlink" href="#advanced-build-server" title="Link to this heading"></a></h2>
<p>For the eight servers, the open62541-server template is used and the first step is the definition of a method to load the corresponding JSON configuration files.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;signal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;unistd.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/plugin/log_stdout.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/server.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;namespace_pfdl_parameter_generated.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;namespace_warehouse_generated.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;namespace_common_generated.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;namespace_coating_generated.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;namespace_milling_generated.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;namespace_gluing_generated.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;namespace_mounting_generated.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;types_common_generated.h&quot;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;custom_behavior/service_callbacks.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;swap_it.h&quot;</span>

<span class="n">UA_Boolean</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stopHandler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sign</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;received ctrl-c&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="nf">loadFile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">fileContents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING_NULL</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* Open the file */</span>
<span class="w">    </span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rb&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//errno = 0; /* We read errno also from the tcp layer... */</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;failed to load the file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fileContents</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cm">/* Get the file length, allocate the data and read */</span>
<span class="w">    </span><span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_END</span><span class="p">);</span>
<span class="w">    </span><span class="n">fileContents</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">ftell</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="w">    </span><span class="n">fileContents</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_Byte</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">UA_malloc</span><span class="p">(</span><span class="n">fileContents</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_Byte</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">fileContents</span><span class="p">.</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="p">);</span>
<span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="n">fileContents</span><span class="p">.</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_Byte</span><span class="p">),</span><span class="w"> </span><span class="n">fileContents</span><span class="p">.</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">fp</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">read</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">fileContents</span><span class="p">.</span><span class="n">length</span><span class="p">)</span>
<span class="w">            </span><span class="n">UA_ByteString_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fileContents</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fileContents</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fileContents</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since each of the different server requires a custom method callback, an additional directory, custom_behavior is defined that includes a header and a source file. In this source file, each of the method callbacks for the different server are defined.</p>
<p><strong>Header File</strong></p>
<p>Within the header file, the event for each method is called from a separate thread, to enable a sincronous methodcallback and an asynchronous event, that indicates the completion of the service execution. Since this thread only browses the corresponding server
for the eventtype and then, triggers the event, this thread uses the function find_service_event from the open62541 swap server template.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef OPEN62541_SERVICE_CALLBACKS_H</span>
<span class="cp">#define OPEN62541_SERVICE_CALLBACKS_H</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/plugin/log_stdout.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;stdio.h&quot;</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">warehousemethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">coatingmethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">millingmethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">gluingmethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                   </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                   </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                   </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">mountingmethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                     </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                     </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">);</span>

<span class="cp">#endif  </span><span class="c1">// OPEN62541_SERVICE_CALLBACKS_H</span>
</pre></div>
</div>
<p><strong>Source File</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/plugin/log_stdout.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/server.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;types_common_generated_handling.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;types_pfdl_parameter_generated.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;service_callbacks.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;node_finder.h&quot;</span>

<span class="cm">/*define structures for the event thread*/</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">service_name</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">;</span>
<span class="w">    </span><span class="n">pthread_t</span><span class="w"> </span><span class="n">threadId</span><span class="p">;</span>
<span class="p">}</span><span class="n">UA_simple_service_handler</span><span class="p">;</span>

<span class="cm">/*function to call the event*/</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">execute_event_with_order_result</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">){</span>
<span class="w">    </span><span class="n">UA_simple_service_handler</span><span class="w"> </span><span class="o">*</span><span class="n">service_dict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_simple_service_handler</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING_NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_dict</span><span class="o">-&gt;</span><span class="n">service_name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_STRING</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Trigger the event of service : %.*s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">out</span><span class="p">.</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">event_nodeId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NodeId_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event_nodeId</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//browse the server for the service finished event type</span>
<span class="w">    </span><span class="n">find_service_event</span><span class="p">(</span><span class="n">service_dict</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">event_nodeId</span><span class="p">,</span><span class="w"> </span><span class="n">service_dict</span><span class="o">-&gt;</span><span class="n">service_name</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event_nodeId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_NODEID</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;ServiceEvent NodeId : %.*s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">out</span><span class="p">.</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_dict</span><span class="o">-&gt;</span><span class="n">service_name</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_SWAP_Order</span><span class="w"> </span><span class="n">order</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_SWAP_Order_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="n">number_light_segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="n">segmentsSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Light_Segment</span><span class="w"> </span><span class="o">*</span><span class="n">segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_Light_Segment</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_Light_Segment</span><span class="p">));</span>
<span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">diameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">segment_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">diameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;green&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">segment_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_Stand_Segment</span><span class="w"> </span><span class="n">stand</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Stand_Segment_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stand</span><span class="p">);</span>
<span class="w">    </span><span class="n">stand</span><span class="p">.</span><span class="n">stand_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="n">stand</span><span class="p">.</span><span class="n">stand_shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;plate&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">stand</span><span class="p">.</span><span class="n">stand_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="n">stand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stand</span><span class="p">;</span>
<span class="w">    </span><span class="n">order</span><span class="p">.</span><span class="n">segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">segments</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES_PFDL_PARAMETER</span><span class="p">[</span><span class="n">UA_TYPES_PFDL_PARAMETER_SWAP_ORDER</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Order Variable: %.*s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">out</span><span class="p">.</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_Variant</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Variant_setScalarCopy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES_PFDL_PARAMETER</span><span class="p">[</span><span class="n">UA_TYPES_PFDL_PARAMETER_SWAP_ORDER</span><span class="p">]);</span>

<span class="w">    </span><span class="c1">//create the event</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">eventOutNodeId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NodeId_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventOutNodeId</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Server_createEvent</span><span class="p">(</span><span class="n">service_dict</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">event_nodeId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">eventOutNodeId</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_USERLAND</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Trigger the event&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//write the output value to the event</span>
<span class="w">    </span><span class="n">UA_Server_writeObjectProperty_scalar</span><span class="p">(</span><span class="n">service_dict</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">eventOutNodeId</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;order&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES_PFDL_PARAMETER</span><span class="p">[</span><span class="n">UA_TYPES_PFDL_PARAMETER_SWAP_ORDER</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_Server_triggerEvent</span><span class="p">(</span><span class="n">service_dict</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">eventOutNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_SERVER</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">UA_TRUE</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//clear allocated memory</span>
<span class="w">    </span><span class="n">UA_NodeId_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventOutNodeId</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_NodeId_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event_nodeId</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">service_dict</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="n">segments</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*method callbacks for the corresponding service methods*/</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">warehousemethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                             </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                             </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">){</span>

<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">service_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;GetPartsFromWarehouse&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_USERLAND</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Service execution Started&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_simple_service_handler</span><span class="w"> </span><span class="o">*</span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_simple_service_handler</span><span class="p">));</span>
<span class="w">    </span><span class="n">UA_String_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">service_name</span><span class="p">);</span>
<span class="w">    </span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">;</span>
<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">threadId</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">execute_event_with_order_result</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//create the ServiceExecutionAsyncResultDataType variable</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_UInt32</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Message&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">expectedServiceExecutionDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_Double</span><span class="p">)</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceTriggerResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_SERVICETRIGGERRESULT_SERVICE_RESULT_ACCEPTED</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Variant_setScalarCopy</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES_COMMON</span><span class="p">[</span><span class="n">UA_TYPES_COMMON_SERVICEEXECUTIONASYNCRESULTDATATYPE</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">coatingmethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">){</span>

<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">service_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Coating&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_USERLAND</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Service execution Started&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_simple_service_handler</span><span class="w"> </span><span class="o">*</span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_simple_service_handler</span><span class="p">));</span>
<span class="w">    </span><span class="n">UA_String_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">service_name</span><span class="p">);</span>
<span class="w">    </span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">;</span>
<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">threadId</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">execute_event_with_order_result</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//create the ServiceExecutionAsyncResultDataType variable</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_UInt32</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Message&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">expectedServiceExecutionDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_Double</span><span class="p">)</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceTriggerResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_SERVICETRIGGERRESULT_SERVICE_RESULT_ACCEPTED</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Variant_setScalarCopy</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES_COMMON</span><span class="p">[</span><span class="n">UA_TYPES_COMMON_SERVICEEXECUTIONASYNCRESULTDATATYPE</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">millingmethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">){</span>

<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">service_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Milling&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_USERLAND</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Service execution Started&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_simple_service_handler</span><span class="w"> </span><span class="o">*</span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_simple_service_handler</span><span class="p">));</span>
<span class="w">    </span><span class="n">UA_String_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">service_name</span><span class="p">);</span>
<span class="w">    </span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">;</span>
<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">threadId</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">execute_event_with_order_result</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//create the ServiceExecutionAsyncResultDataType variable</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_UInt32</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Message&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">expectedServiceExecutionDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_Double</span><span class="p">)</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceTriggerResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_SERVICETRIGGERRESULT_SERVICE_RESULT_ACCEPTED</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Variant_setScalarCopy</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES_COMMON</span><span class="p">[</span><span class="n">UA_TYPES_COMMON_SERVICEEXECUTIONASYNCRESULTDATATYPE</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">gluingmethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">){</span>

<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">service_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Gluing&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_USERLAND</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Service execution Started&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_simple_service_handler</span><span class="w"> </span><span class="o">*</span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_simple_service_handler</span><span class="p">));</span>
<span class="w">    </span><span class="n">UA_String_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">service_name</span><span class="p">);</span>
<span class="w">    </span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">;</span>
<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">threadId</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">execute_event_with_order_result</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//create the ServiceExecutionAsyncResultDataType variable</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_UInt32</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Message&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">expectedServiceExecutionDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_Double</span><span class="p">)</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceTriggerResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_SERVICETRIGGERRESULT_SERVICE_RESULT_ACCEPTED</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Variant_setScalarCopy</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES_COMMON</span><span class="p">[</span><span class="n">UA_TYPES_COMMON_SERVICEEXECUTIONASYNCRESULTDATATYPE</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="nf">mountingmethodCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                   </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionHandle</span><span class="p">,</span>
<span class="w">                                   </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                                   </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                                   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                                   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">){</span>

<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">service_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Mounting&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_USERLAND</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Service execution Started&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_simple_service_handler</span><span class="w"> </span><span class="o">*</span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_simple_service_handler</span><span class="p">));</span>
<span class="w">    </span><span class="n">UA_String_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">service_name</span><span class="p">);</span>
<span class="w">    </span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">;</span>
<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">threadId</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">execute_event_with_order_result</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//create the ServiceExecutionAsyncResultDataType variable</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServiceExecutionAsyncResultDataType_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_UInt32</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_String_fromChars</span><span class="p">(</span><span class="s">&quot;Message&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">expectedServiceExecutionDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_Double</span><span class="p">)</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">serviceTriggerResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_SERVICETRIGGERRESULT_SERVICE_RESULT_ACCEPTED</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Variant_setScalarCopy</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES_COMMON</span><span class="p">[</span><span class="n">UA_TYPES_COMMON_SERVICEEXECUTIONASYNCRESULTDATATYPE</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_String_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">.</span><span class="n">serviceResultMessage</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, going back to the main.c file, two structures are defined from which each server configuration will be handed over to the corresponding server thread.
The structure server_info contains the path to the JSON configuration file and the method callback of the corresponding server. Since a generic function for the
server start inside each thread is used, it is not possible to preset the function with which the namespaces are loaded. To solve this problem, a list of pointers to
the corresponding load namespace functions is provided (* load_namespace). The index of the corresponding function is stored within the server_info structure. Lastly, the structure
server_dict contains a list with all server configurations, so that all threads can be started from a loop over the server_dict.number_server variable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span><span class="p">{</span>
    <span class="n">char</span><span class="o">*</span> <span class="n">path_to_config</span><span class="p">;</span>
    <span class="n">size_t</span> <span class="n">namespace_position</span><span class="p">;</span>
    <span class="n">UA_Boolean</span> <span class="o">*</span><span class="n">running</span><span class="p">;</span>
    <span class="n">pthread_t</span> <span class="n">threadId</span><span class="p">;</span>
    <span class="n">UA_MethodCallback</span> <span class="n">methodcallback</span><span class="p">;</span>
<span class="p">}</span><span class="n">server_info</span><span class="p">;</span>

<span class="n">typedef</span> <span class="n">struct</span><span class="p">{</span>
    <span class="n">size_t</span> <span class="n">number_server</span><span class="p">;</span>
    <span class="n">server_info</span> <span class="o">*</span><span class="n">server</span><span class="p">;</span>
<span class="p">}</span><span class="n">server_dict</span><span class="p">;</span>


<span class="n">UA_StatusCode</span> <span class="p">(</span><span class="o">*</span> <span class="n">load_namespace</span><span class="p">[])(</span><span class="n">UA_Server</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">namespace_pfdl_parameter_generated</span><span class="p">,</span>
        <span class="n">namespace_warehouse_generated</span><span class="p">,</span>
        <span class="n">namespace_coating_generated</span><span class="p">,</span>
        <span class="n">namespace_milling_generated</span><span class="p">,</span>
        <span class="n">namespace_gluing_generated</span><span class="p">,</span>
        <span class="n">namespace_mounting_generated</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In the next step, the generic start_server function is defined, which is executed within each server thread and starts the corresponding OPC UA server. In contrast to the previous tutorials, the UA_Boolean register_agent_in_registry in the UA_Server_swap_it
function and the argument UA_Boolean unregister in the clear_swap_server functions are set to UA_TRUE.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">start_server</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">){</span>
<span class="w">    </span><span class="n">server_info</span><span class="w"> </span><span class="o">*</span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">server_info</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_Server_new</span><span class="p">();</span>
<span class="w">    </span><span class="cm">/*load additional swap namespaces*/</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">namespace_common_generated</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UA_LOG_WARNING</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adding the common namespace failed. Please check previous error output.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">UA_Server_delete</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="w"> </span><span class="n">import_namespace</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="n">load_namespace</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">import_namespace</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UA_LOG_ERROR</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adding the sfb_parameter namespace failed. Please check previous error output.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">UA_Server_delete</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">import_namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load_namespace</span><span class="p">[</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">namespace_position</span><span class="p">];</span>
<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">import_namespace</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UA_LOG_ERROR</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adding the namespace on pos %zu in the load_namespace function failed. Please check previous error output.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">namespace_position</span><span class="p">);</span>
<span class="w">        </span><span class="n">UA_Server_delete</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadFile</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">path_to_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_service_server_interpreter</span><span class="w"> </span><span class="n">swap_server</span><span class="p">;</span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">swap_server</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_service_server_interpreter</span><span class="p">));</span>

<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_server_swap_it</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">json</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">methodcallback</span><span class="p">,</span><span class="w"> </span><span class="n">UA_FALSE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">,</span><span class="w"> </span><span class="n">UA_TRUE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">swap_server</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">){</span>
<span class="w">        </span><span class="n">UA_ByteString_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">json</span><span class="p">);</span>
<span class="w">        </span><span class="n">pthread_exit</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">threadId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">        </span><span class="n">UA_ByteString_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">json</span><span class="p">);</span>
<span class="w">        </span><span class="n">UA_Server_run_startup</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="n">running</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UA_Server_run_iterate</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span><span class="s">&quot;Shutting down server %s &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">swap_server</span><span class="p">.</span><span class="n">server_name</span><span class="p">);</span>
<span class="w">        </span><span class="cm">/*unregister the agent and clear the config information*/</span>
<span class="w">        </span><span class="n">clear_swap_server</span><span class="p">(</span><span class="o">&amp;</span><span class="n">swap_server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="p">);</span>
<span class="w">        </span><span class="n">UA_Server_run_shutdown</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">        </span><span class="n">UA_Server_delete</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">        </span><span class="n">pthread_exit</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">threadId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, it is possible to define the main function from which all treads are started.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stopHandler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sign</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;received ctrl-c&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">stopHandler</span><span class="p">);</span>
<span class="w">    </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGTERM</span><span class="p">,</span><span class="w"> </span><span class="n">stopHandler</span><span class="p">);</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">nbr_resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">    </span><span class="n">server_dict</span><span class="w"> </span><span class="n">resources</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">number_server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nbr_resources</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">server_info</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">nbr_resources</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">server_info</span><span class="p">));</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_to_warehouse_1_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../configs/warehouse_config.json5&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">path_to_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path_to_warehouse_1_config</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">,</span><span class="w"> </span><span class="n">path_to_warehouse_1_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">namespace_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">methodcallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">warehousemethodCallback</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_to_coating_1_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../configs/coating_config.json5&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">path_to_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path_to_coating_1_config</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">,</span><span class="w"> </span><span class="n">path_to_coating_1_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">namespace_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">methodcallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coatingmethodCallback</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_to_milling_1_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../configs/milling_config.json5&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">path_to_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path_to_milling_1_config</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">,</span><span class="w"> </span><span class="n">path_to_milling_1_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">namespace_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">methodcallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">millingmethodCallback</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_to_gluing_1_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../configs/gluing_config.json5&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">path_to_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path_to_gluing_1_config</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">,</span><span class="w"> </span><span class="n">path_to_gluing_1_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">namespace_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">methodcallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gluingmethodCallback</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_to_mounting_1_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../configs/mounting_config.json5&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">path_to_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path_to_mounting_1_config</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">,</span><span class="w"> </span><span class="n">path_to_mounting_1_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">namespace_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">methodcallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mountingmethodCallback</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_to_warehouse_2_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../configs/warehouse_config_2.json5&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">path_to_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path_to_warehouse_2_config</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">,</span><span class="w"> </span><span class="n">path_to_warehouse_2_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">namespace_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">methodcallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">warehousemethodCallback</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_to_coating_2_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../configs/coating_config_2.json5&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">path_to_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path_to_coating_2_config</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">,</span><span class="w"> </span><span class="n">path_to_coating_2_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">namespace_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">methodcallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coatingmethodCallback</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path_to_coating_3_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../configs/coating_config_3.json5&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">path_to_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path_to_coating_3_config</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">,</span><span class="w"> </span><span class="n">path_to_coating_3_config</span><span class="p">);</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">running</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">namespace_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">methodcallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coatingmethodCallback</span><span class="p">;</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;start the threads</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">resources</span><span class="p">.</span><span class="n">number_server</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">threadId</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">start_server</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">running</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">resources</span><span class="p">.</span><span class="n">number_server</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">path_to_config</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="n">server</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="advanced-build-the-server-executable">
<h3>Advanced: Build the Server Executable<a class="headerlink" href="#advanced-build-the-server-executable" title="Link to this heading"></a></h3>
<p>After the code is completed, it is now possible to compile the server executable. For this to be achieved, create a build directory within the working directory and compile the server with the cmake and make command.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">directory</span>
<span class="n">mkdir</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">build</span>
<span class="n">cmake</span><span class="w"> </span><span class="p">..</span>
<span class="n">make</span>
<span class="cm">/*start the executable*/</span>
<span class="p">.</span><span class="o">/</span><span class="n">swap_server</span>
</pre></div>
</div>
<p><strong>Important note:</strong>
Since the server try to register themselves within a device registry, it has to be ensured that a corresponding instance of a device registry is running.</p>
</section>
</section>
<section id="advanced-execute-the-pfdl-with-a-process-agent">
<h2>Advanced: Execute the PFDL with a Process Agent<a class="headerlink" href="#advanced-execute-the-pfdl-with-a-process-agent" title="Link to this heading"></a></h2>
<p>Since the advanced tutorial features a dynamic resource assignment, an instance of a device registry has to be started to make the server available to the system.</p>
<section id="start-the-application-with-docker-images">
<h3>Start the Application with Docker Images<a class="headerlink" href="#start-the-application-with-docker-images" title="Link to this heading"></a></h3>
<p>An easy approach to start the application and start processes on the servers created within this tutorial are docker container that are available within the GitHub package registry. The application ca be started in 3 steps,
first the docker container of the device registry has to be started. Second, the shop floor build within this tutorial has to be started. In the last step, the process agent is started, which then executes the PFDL of the Demonstration Scenario.</p>
<section id="step-1-start-the-device-registry">
<h4>Step 1: Start the Device Registry<a class="headerlink" href="#step-1-start-the-device-registry" title="Link to this heading"></a></h4>
<p>For the device registry, a pre-build docker container is available which can be started with:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mi">8000</span><span class="o">:</span><span class="mi">8000</span><span class="w"> </span><span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">host</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">docker</span><span class="p">.</span><span class="n">internal</span><span class="o">:</span><span class="n">host</span><span class="o">-</span><span class="n">gateway</span><span class="w"> </span><span class="n">ghcr</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">swap</span><span class="o">-</span><span class="n">it</span><span class="o">/</span><span class="n">demo</span><span class="o">-</span><span class="n">scenario</span><span class="o">/</span><span class="n">device_registry</span><span class="o">:</span><span class="n">latest</span>
</pre></div>
</div>
</section>
<section id="step-2-start-the-shop-floor-server">
<h4>Step 2: Start the Shop Floor Server<a class="headerlink" href="#step-2-start-the-shop-floor-server" title="Link to this heading"></a></h4>
<p>Since docker container have an individual networking, a minor modification on the JSON configuration files has to be performed to enable the connection between the docker container and the shop floor servers.
Here, the key <strong>resource_ip</strong> has to be changed to resource_ip: “host.docker.internal”.</p>
<p>The configuration file for the milling server would then look like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">//mandatory</span>
<span class="w">  </span><span class="nl">application_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;milling_dr1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">resource_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;host.docker.internal&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4071&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MillingModuleType&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">module_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MillingModule&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nl">service_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Milling&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="c1">//optional</span>
<span class="w">  </span><span class="nl">device_registry</span><span class="p">:</span><span class="s">&quot;opc.tcp://localhost:8000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, this step has to be repeated for all configurations that are defined in section <a class="reference internal" href="#advanced-writing-a-json-configuration-file">Advanced Writing a JSON-configuration File</a>.</p>
<p>In case of an individual implementation of this tutorial, the shop floor can be started with the following steps:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">directory</span>
<span class="n">mkdir</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">build</span>
<span class="n">cmake</span><span class="w"> </span><span class="p">..</span>
<span class="n">make</span>
<span class="cm">/*start the executable*/</span>
<span class="p">.</span><span class="o">/</span><span class="n">swap_server</span>
</pre></div>
</div>
<p>In case that the shop floor should be started from the tutorial implementation, execute the following steps:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/swap-it/demo-scenario.git</span>
<span class="n">cd</span><span class="w"> </span><span class="n">demo</span><span class="o">-</span><span class="n">scenario</span><span class="o">/</span><span class="n">Tutorials</span><span class="o">/</span><span class="n">advanced</span>
<span class="n">mkdir</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">build</span>
<span class="n">cmake</span><span class="w"> </span><span class="p">..</span>
<span class="n">make</span>
<span class="cm">/*start the executable*/</span>
<span class="p">.</span><span class="o">/</span><span class="n">swap_server</span>
</pre></div>
</div>
</section>
<section id="step-3-start-the-process-agent">
<h4>Step 3: Start the Process Agent<a class="headerlink" href="#step-3-start-the-process-agent" title="Link to this heading"></a></h4>
<p>Since the code basis of the process agent in not available yet, we provide a docker compose file which starts the missing application, in fact the process agent and the dashboard, in a docker compose project. A corresponding
Docker-compose.yaml file is provided in the <a class="reference external" href="https://github.com/swap-it/demo-scenario/tree/main/Tutorials/advanced">advanced directory</a>.
This docker application can be started with the following steps, so that the beginner tutorial PFDL and the corresponding process is executed on the resource, which is implemented in this tutorial:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/swap-it/demo-scenario.git</span>
<span class="n">cd</span><span class="w"> </span><span class="n">demo</span><span class="o">-</span><span class="n">scenario</span><span class="o">/</span><span class="n">Tutorials</span><span class="o">/</span><span class="n">advanced</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="w"> </span><span class="n">up</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intermediate.html" class="btn btn-neutral float-left" title="Intermediate" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="how_to.html" class="btn btn-neutral float-right" title="How-To-Guides" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024, Fraunhofer IOSB.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>